# Internationalization (i18n) & RTL Support

ChatKit provides comprehensive support for Right-to-Left (RTL) languages including Arabic, Hebrew, Persian, and Urdu.

## Quick Start

### Basic RTL Text

```python
from chatkit.widgets import Text

# Arabic text with explicit RTL direction
text = Text(
    value="مرحباً بك في ChatKit",
    dir="rtl",
    lang="ar"
)
```

### Automatic Direction Detection

```python
from chatkit.i18n import detect_text_direction

text = "مرحباً بك في ChatKit"
direction = detect_text_direction(text)  # Returns "rtl"

# Use in widget
widget = Text(value=text, dir=direction, lang="ar")
```

## Direction Options

All text-based widgets support the `dir` property with three values:

- **`"ltr"`**: Left-to-Right (English, French, etc.)
- **`"rtl"`**: Right-to-Left (Arabic, Hebrew, etc.)
- **`"auto"`**: Automatic detection based on content

## Supported Widgets

The following widgets support RTL:

### Text Widgets
- `Text` - Plain text
- `Title` - Headlines
- `Caption` - Supporting text
- `Markdown` - Markdown content

### Input Widgets
- `Input` - Single-line input
- `Textarea` - Multi-line input
- `Label` - Form labels
- `Button` - Button labels

### Container Widgets
- `Card` - Card containers
- `ListView` - List views

## Language Detection Functions

### `is_rtl_language(lang_code: str) -> bool`

Check if a language code represents an RTL language.

```python
from chatkit.i18n import is_rtl_language

is_rtl_language('ar')  # True
is_rtl_language('he')  # True
is_rtl_language('en')  # False
```

### `detect_text_direction(text: str) -> Literal["ltr", "rtl", "auto"]`

Automatically detect text direction based on content.

```python
from chatkit.i18n import detect_text_direction

detect_text_direction("مرحبا")  # "rtl"
detect_text_direction("Hello")  # "ltr"
detect_text_direction("مرحبا Hello")  # "auto" (mixed)
```

### `guess_language_from_text(text: str) -> str | None`

Attempt to guess the language from text content.

```python
from chatkit.i18n import guess_language_from_text

guess_language_from_text("مرحبا")  # "ar"
guess_language_from_text("שלום")  # "he"
```

## Bidirectional Text Utilities

### `wrap_with_direction_markers(text: str, direction: Literal["ltr", "rtl"]) -> str`

Wrap text with Unicode directional markers.

```python
from chatkit.bidi import wrap_with_direction_markers

wrapped = wrap_with_direction_markers("مرحبا", "rtl")
# Adds Unicode RLE markers for proper rendering
```

### `fix_arabic_numbers_in_text(text: str) -> str`

Fix the display of numbers in Arabic text.

```python
from chatkit.bidi import fix_arabic_numbers_in_text

text = fix_arabic_numbers_in_text("عدد 123 شيء")
# Numbers are wrapped with LTR markers
```

### `normalize_mixed_text(text: str) -> str`

Normalize mixed-direction text for proper display.

```python
from chatkit.bidi import normalize_mixed_text

normalized = normalize_mixed_text("Hello مرحبا World")
# Each segment is wrapped with appropriate markers
```

## Complete Examples

### RTL Login Form

```python
from chatkit.widgets import Card, Title, Caption, Col, Label, Input, Button, Row

login_card = Card(
    dir="rtl",
    lang="ar",
    children=[
        Title(value="تسجيل الدخول", dir="rtl"),
        Caption(value="أدخل بيانات الدخول", dir="rtl"),
        Col(
            gap=4,
            children=[
                Label(value="البريد الإلكتروني", fieldName="email", dir="rtl"),
                Input(
                    name="email",
                    placeholder="أدخل بريدك",
                    dir="rtl",
                    lang="ar",
                    inputType="email"
                ),
                Label(value="كلمة المرور", fieldName="password", dir="rtl"),
                Input(
                    name="password",
                    placeholder="أدخل كلمة المرور",
                    dir="rtl",
                    lang="ar",
                    inputType="password"
                ),
                Row(
                    gap=2,
                    justify="end",
                    children=[
                        Button(label="إلغاء", dir="rtl", variant="outline"),
                        Button(label="دخول", dir="rtl", style="primary"),
                    ]
                )
            ]
        )
    ]
)
```

### Mixed Direction Content

```python
from chatkit.widgets import Card, Text, Col

card = Card(
    dir="auto",  # Auto-detect
    children=[
        Col(
            gap=2,
            children=[
                Text(value="Welcome / مرحبا", dir="auto"),
                Text(value="Features / المميزات", dir="auto"),
                Text(value="Support / الدعم", dir="auto"),
            ]
        )
    ]
)
```

### RTL Markdown

```python
from chatkit.widgets import Markdown

markdown = Markdown(
    value="""
# مرحباً بك

## المميزات

- دعم كامل للعربية
- واجهة سهلة
- أداء عالي

### مثال

```python
text = Text(value="مرحبا", dir="rtl")
```
    """,
    dir="rtl",
    lang="ar"
)
```

## Best Practices

### 1. Use Explicit Direction When Known

```python
# Good: Explicit direction
Text(value="مرحبا", dir="rtl", lang="ar")

# Avoid: Relying on auto-detection when you know the direction
Text(value="مرحبا")  # Will work but less efficient
```

### 2. Specify Language Code

Always specify the `lang` attribute for better browser support and accessibility:

```python
Text(value="مرحبا", dir="rtl", lang="ar")
Text(value="שלום", dir="rtl", lang="he")
```

### 3. Keep Technical Content LTR

Email addresses, URLs, and code should remain LTR even in RTL contexts:

```python
Card(
    dir="rtl",
    children=[
        Label(value="البريد الإلكتروني", fieldName="email", dir="rtl"),
        Input(
            name="email",
            placeholder="user@example.com",
            dir="ltr",  # Keep email LTR
            inputType="email"
        )
    ]
)
```

### 4. Use Auto for Mixed Content

When content contains both RTL and LTR text, use `dir="auto"`:

```python
Text(
    value="مرحبا ChatKit مرحبا",
    dir="auto"  # Browser will handle the mixed content
)
```

### 5. Cache Detection Results

For performance, cache direction detection results:

```python
from chatkit.i18n import detect_text_direction

# Cache the result
texts = ["مرحبا", "Hello", "שלום"]
directions = {text: detect_text_direction(text) for text in texts}

# Reuse cached results
for text in texts:
    widget = Text(value=text, dir=directions[text])
```

## Supported Languages

ChatKit supports the following RTL languages:

| Language | Code | Example |
|----------|------|---------|
| Arabic | `ar` | مرحبا |
| Hebrew | `he` | שלום |
| Persian (Farsi) | `fa` | سلام |
| Urdu | `ur` | ہیلو |
| Yiddish | `yi` | העלא |
| Pashto | `ps` | سلام |

## Unicode Bidirectional Markers

ChatKit uses standard Unicode bidirectional control characters:

- **RLM** (`\u200F`): Right-to-Left Mark
- **LRM** (`\u200E`): Left-to-Right Mark
- **RLE** (`\u202B`): Right-to-Left Embedding
- **LRE** (`\u202A`): Left-to-Right Embedding
- **PDF** (`\u202C`): Pop Directional Formatting

These are automatically added by the `bidi` utilities when needed.

## Troubleshooting

### Numbers Display Incorrectly

Use `fix_arabic_numbers_in_text()` to fix number display in RTL text:

```python
from chatkit.bidi import fix_arabic_numbers_in_text

text = fix_arabic_numbers_in_text("السعر 99.99 دولار")
```

### Mixed Text Breaks Layout

Use `normalize_mixed_text()` to properly handle mixed-direction text:

```python
from chatkit.bidi import normalize_mixed_text

text = normalize_mixed_text("Hello مرحبا World")
```

### Punctuation in Wrong Position

This is usually handled automatically by browsers, but you can use the bidi utilities for more control:

```python
from chatkit.bidi import wrap_with_direction_markers

text = wrap_with_direction_markers("مرحبا!", "rtl")
```

## API Reference

For detailed API documentation, see:

- [i18n Module Reference](../api/chatkit/i18n.md)
- [bidi Module Reference](../api/chatkit/bidi.md)

## Examples

Complete working examples can be found in the `examples/` directory:

- `examples/rtl_support_example.py` - Comprehensive RTL examples

## Contributing

We welcome contributions to improve RTL support! See our [Contributing Guide](../CONTRIBUTING.md) for details.
