
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../update-client-during-response/">
      
      
        <link rel="next" href="../add-annotations/">
      
      
      <link rel="icon" href="../../images/favicon-platform.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.21">
    
    
      
        <title>Build interactive responses with widgets - Chatkit Python SDK</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2a3383ac.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#build-interactive-responses-with-widgets" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Chatkit Python SDK" class="md-header__button md-logo" aria-label="Chatkit Python SDK" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Chatkit Python SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Build interactive responses with widgets
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/openai/chatkit-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    chatkit-python
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Chatkit Python SDK" class="md-nav__button md-logo" aria-label="Chatkit Python SDK" data-md-component="logo">
      
  <img src="../../assets/logo.svg" alt="logo">

    </a>
    Chatkit Python SDK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/openai/chatkit-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    chatkit-python
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quick start
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Concepts
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Concepts
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/threads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Threads and items
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/thread-stream-events/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Thread stream events
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Widgets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/actions/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Actions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../concepts/entities/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Entities
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Guides
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../respond-to-user-message/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Respond to a user message
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../browse-past-threads/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Let users browse past threads
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../accept-rich-user-input/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Accept rich user input
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../let-users-pick-tools-and-models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Let users pick tools and models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pass-extra-app-context-to-your-model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pass extra app context to your model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../update-client-during-response/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Update the client during a response
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Build interactive responses with widgets
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Build interactive responses with widgets
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-widgets-in-chatkit-studio" class="md-nav__link">
    <span class="md-ellipsis">
      Design widgets in ChatKit Studio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-widgets-with-widgettemplate" class="md-nav__link">
    <span class="md-ellipsis">
      Build widgets with WidgetTemplate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-widgets-from-respond" class="md-nav__link">
    <span class="md-ellipsis">
      Stream widgets from respond
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-widgets-from-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Stream widgets from tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-widget-updates-while-text-streams" class="md-nav__link">
    <span class="md-ellipsis">
      Stream widget updates while text streams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handle-widget-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Handle widget actions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handle widget actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-actions-in-your-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Define actions in your widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-client-vs-server-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Choose client vs server handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-actions-on-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      Handle actions on the server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-actions-on-the-client" class="md-nav__link">
    <span class="md-ellipsis">
      Handle actions on the client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control-loading-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Control loading behavior
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-custom-forms-with-widgets" class="md-nav__link">
    <span class="md-ellipsis">
      Create custom forms with widgets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create custom forms with widgets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#treating-card-as-a-form" class="md-nav__link">
    <span class="md-ellipsis">
      Treating Card as a Form
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payload-key-collisions" class="md-nav__link">
    <span class="md-ellipsis">
      Payload key collisions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add-annotations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Add annotations in assistant messages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../stream-generated-images/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Stream generated images
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../keep-your-app-in-sync-with-chatkit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Keep your app in sync with ChatKit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../let-your-app-draft-and-send-messages/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Let your app draft and send messages
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../handle-feedback/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Handle feedback
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../prepare-your-app-for-production/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Prepare your app for production
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Modules
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Modules
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/agents/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    agents
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/errors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    errors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/server/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    server
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    types
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/widgets/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    widgets
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/chatkit/icons/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    icons
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../release/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Release process / changelog
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="https://openai.github.io/chatkit-js/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    ChatKit JS Docs
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#design-widgets-in-chatkit-studio" class="md-nav__link">
    <span class="md-ellipsis">
      Design widgets in ChatKit Studio
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#build-widgets-with-widgettemplate" class="md-nav__link">
    <span class="md-ellipsis">
      Build widgets with WidgetTemplate
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-widgets-from-respond" class="md-nav__link">
    <span class="md-ellipsis">
      Stream widgets from respond
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-widgets-from-tools" class="md-nav__link">
    <span class="md-ellipsis">
      Stream widgets from tools
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stream-widget-updates-while-text-streams" class="md-nav__link">
    <span class="md-ellipsis">
      Stream widget updates while text streams
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#handle-widget-actions" class="md-nav__link">
    <span class="md-ellipsis">
      Handle widget actions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Handle widget actions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#define-actions-in-your-widget" class="md-nav__link">
    <span class="md-ellipsis">
      Define actions in your widget
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#choose-client-vs-server-handling" class="md-nav__link">
    <span class="md-ellipsis">
      Choose client vs server handling
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-actions-on-the-server" class="md-nav__link">
    <span class="md-ellipsis">
      Handle actions on the server
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#handle-actions-on-the-client" class="md-nav__link">
    <span class="md-ellipsis">
      Handle actions on the client
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#control-loading-behavior" class="md-nav__link">
    <span class="md-ellipsis">
      Control loading behavior
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-custom-forms-with-widgets" class="md-nav__link">
    <span class="md-ellipsis">
      Create custom forms with widgets
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Create custom forms with widgets">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#validation" class="md-nav__link">
    <span class="md-ellipsis">
      Validation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#treating-card-as-a-form" class="md-nav__link">
    <span class="md-ellipsis">
      Treating Card as a Form
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#payload-key-collisions" class="md-nav__link">
    <span class="md-ellipsis">
      Payload key collisions
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="build-interactive-responses-with-widgets">Build interactive responses with widgets</h1>
<p>Use widgets to turn assistant responses into rich, interactive UIs. Design widgets visually, hydrate them with data on the server, stream them into the conversation, and wire actions and forms so users can click, edit, and submit without writing long free-text prompts.</p>
<p>This guide covers:</p>
<ul>
<li>Designing and loading widget templates</li>
<li>Streaming widgets from <code>respond</code> and from tools</li>
<li>Handling widget actions on the server and client</li>
<li>Building editable forms with widgets</li>
</ul>
<h2 id="design-widgets-in-chatkit-studio">Design widgets in ChatKit Studio</h2>
<p>Use <a href="https://widgets.chatkit.studio">https://widgets.chatkit.studio</a> to visually design cards, lists, forms, charts, and other widget components. Populate the <strong>Data</strong> panel with sample values to preview how the widget renders with real inputs.</p>
<p>When the layout and bindings look correct, click <strong>Export</strong> to download the generated <code>.widget</code> file. Commit this file alongside the server code that builds and renders the widget.</p>
<h2 id="build-widgets-with-widgettemplate">Build widgets with <code>WidgetTemplate</code></h2>
<p>Load the <code>.widget</code> file with <code>WidgetTemplate.from_file</code> and hydrate it with runtime data. Placeholders inside the <code>.widget</code> template (Jinja-style <code>{{ }}</code> expressions) are rendered before the widget is streamed.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.widgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">WidgetTemplate</span>

<span class="n">message_template</span> <span class="o">=</span> <span class="n">WidgetTemplate</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;widgets/channel_message.widget&quot;</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">build_message_widget</span><span class="p">(</span><span class="n">user_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># Replace this helper with whatever your integration uses to build widgets.</span>
    <span class="k">return</span> <span class="n">message_template</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;user_name&quot;</span><span class="p">:</span> <span class="n">user_name</span><span class="p">,</span>
            <span class="s2">&quot;message&quot;</span><span class="p">:</span> <span class="n">message</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>
</code></pre></div>
<p><code>WidgetTemplate.build</code> accepts plain dicts or Pydantic models. Use <code>.build_basic</code> if you're working with a <code>BasicRoot</code> widget outside of streaming.</p>
<h2 id="stream-widgets-from-respond">Stream widgets from <code>respond</code></h2>
<p>Use <code>stream_widget</code> to emit a one-off widget or stream updates from an async generator.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">stream_widget</span>


<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">respond</span><span class="p">(</span><span class="o">...</span><span class="p">):</span>
    <span class="n">user_name</span> <span class="o">=</span> <span class="s2">&quot;Harry Potter&quot;</span>
    <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;Yer a wizard, Harry&quot;</span>
    <span class="n">message_widget</span> <span class="o">=</span> <span class="n">build_message_widget</span><span class="p">(</span><span class="n">user_name</span><span class="o">=</span><span class="n">user_name</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
    <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stream_widget</span><span class="p">(</span>
        <span class="n">thread</span><span class="p">,</span>
        <span class="n">message_widget</span><span class="p">,</span>
        <span class="n">copy_text</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Message to </span><span class="si">{</span><span class="n">user_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">message</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">generate_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item_type</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">generate_item_id</span><span class="p">(</span>
            <span class="n">item_type</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">context</span>
        <span class="p">),</span>
    <span class="p">):</span>
        <span class="k">yield</span> <span class="n">event</span>
</code></pre></div>
<p>To stream gradual updates, yield successive widget states from an async generator; <code>stream_widget</code> diffs and emits <code>ThreadItemUpdatedEvent</code>s for you.</p>
<h2 id="stream-widgets-from-tools">Stream widgets from tools</h2>
<p>Tools can enqueue widgets via <code>AgentContext.stream_widget</code>; <code>stream_agent_response</code> forwards them to the client.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunContextWrapper</span><span class="p">,</span> <span class="n">function_tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentContext</span>


<span class="nd">@function_tool</span><span class="p">(</span><span class="n">description_override</span><span class="o">=</span><span class="s2">&quot;Display a sample widget to the user.&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">sample_widget</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContextWrapper</span><span class="p">[</span><span class="n">AgentContext</span><span class="p">]):</span>
    <span class="n">message_widget</span> <span class="o">=</span> <span class="n">build_message_widget</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">stream_widget</span><span class="p">(</span><span class="n">message_widget</span><span class="p">)</span>
</code></pre></div>
<h2 id="stream-widget-updates-while-text-streams">Stream widget updates while text streams</h2>
<p>The examples above return a fully completed static widget. You can also stream an updating widget by yielding new versions of the widget from a generator function. The ChatKit framework will send updates for the parts of the widget that have changed.</p>
<p>!!! note "Text streaming support"
    Currently, only <code>&lt;Text&gt;</code> and <code>&lt;Markdown&gt;</code> components marked with an <code>id</code> have their text updates streamed. Other diffs will forgo the streaming UI and replace and rerender parts of the widget client-side.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncGenerator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">RunContextWrapper</span><span class="p">,</span> <span class="n">function_tool</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.agents</span><span class="w"> </span><span class="kn">import</span> <span class="n">AgentContext</span><span class="p">,</span> <span class="n">Runner</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.widgets</span><span class="w"> </span><span class="kn">import</span> <span class="n">WidgetRoot</span>


<span class="nd">@function_tool</span>
<span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">draft_message_to_harry</span><span class="p">(</span><span class="n">ctx</span><span class="p">:</span> <span class="n">RunContextWrapper</span><span class="p">[</span><span class="n">AgentContext</span><span class="p">]):</span>
    <span class="c1"># message_generator is your model/tool function that streams text</span>
    <span class="n">message_result</span> <span class="o">=</span> <span class="n">Runner</span><span class="o">.</span><span class="n">run_streamed</span><span class="p">(</span>
        <span class="n">message_generator</span><span class="p">,</span> <span class="s2">&quot;Draft a message to Harry.&quot;</span>
    <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">widget_generator</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">AsyncGenerator</span><span class="p">[</span><span class="n">WidgetRoot</span><span class="p">,</span> <span class="kc">None</span><span class="p">]:</span>
        <span class="n">message</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">message_result</span><span class="o">.</span><span class="n">stream_events</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">event</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;raw_response_event&quot;</span>
                <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;response.output_text.delta&quot;</span>
            <span class="p">):</span>
                <span class="n">message</span> <span class="o">+=</span> <span class="n">event</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">delta</span>
                <span class="k">yield</span> <span class="n">build_message_widget</span><span class="p">(</span>
                    <span class="n">user_name</span><span class="o">=</span><span class="s2">&quot;Harry Potter&quot;</span><span class="p">,</span>
                    <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="c1"># Final render after streaming completes.</span>
        <span class="k">yield</span> <span class="n">build_message_widget</span><span class="p">(</span>
            <span class="n">user_name</span><span class="o">=</span><span class="s2">&quot;Harry Potter&quot;</span><span class="p">,</span>
            <span class="n">message</span><span class="o">=</span><span class="n">message</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">await</span> <span class="n">ctx</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">stream_widget</span><span class="p">(</span><span class="n">widget_generator</span><span class="p">())</span>
</code></pre></div>
<p>The inner generator collects the streamed text events and rebuilds the widget with the latest message so the UI updates incrementally.</p>
<h2 id="handle-widget-actions">Handle widget actions</h2>
<p>Actions let widget interactions trigger server or client logic without posting a chat message.</p>
<h3 id="define-actions-in-your-widget">Define actions in your widget</h3>
<p>Configure actions as part of the widget definition while you design it in <a href="https://widgets.chatkit.studio">https://widgets.chatkit.studio</a>. Add an action to any action-capable component such as <code>Button.onClickAction</code>; explore supported components on the components page.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">Button</span>
<span class="w">  </span><span class="na">label</span><span class="o">=</span><span class="s">&quot;Send message&quot;</span>
<span class="w">  </span><span class="na">onClickAction</span><span class="o">=</span><span class="p">{{</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;send_message&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Ping support&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">}}</span>
<span class="p">/&gt;</span>
</code></pre></div>
<h3 id="choose-client-vs-server-handling">Choose client vs server handling</h3>
<p>Actions are handled on the server by default and flow into <code>ChatKitServer.action</code>. Set <code>handler: "client"</code> in the action to route it to your frontendâ€™s <code>widgets.onAction</code> instead. Use the server when you need to update thread state or stream widgets; use the client for immediate UI work or to chain into a follow-up <code>sendCustomAction</code> after local logic completes.</p>
<p>Example widget definition with a client action handler:</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">Button</span>
<span class="w">  </span><span class="na">label</span><span class="o">=</span><span class="s">&quot;Send message&quot;</span>
<span class="w">  </span><span class="na">onClickAction</span><span class="o">=</span><span class="p">{{</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;send_message&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">handler</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;client&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">text</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;Ping support&quot;</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">}}</span>
<span class="p">/&gt;</span>
</code></pre></div>
<h3 id="handle-actions-on-the-server">Handle actions on the server</h3>
<p>Implement <code>ChatKitServer.action</code> to process incoming actions. The <code>sender</code> argument is the widget item that triggered the action (if available).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatKitServer</span><span class="p">,</span> <span class="n">stream_widget</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">HiddenContextItem</span><span class="p">,</span> <span class="n">WidgetItem</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyChatKitServer</span><span class="p">(</span><span class="n">ChatKitServer</span><span class="p">[</span><span class="n">RequestContext</span><span class="p">]):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">action</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">action</span><span class="p">,</span> <span class="n">sender</span><span class="p">,</span> <span class="n">context</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;send_message&quot;</span><span class="p">:</span>
            <span class="k">await</span> <span class="n">send_to_chat</span><span class="p">(</span><span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>

            <span class="c1"># Record the user action so the model can see it on the next turn.</span>
            <span class="n">hidden</span> <span class="o">=</span> <span class="n">HiddenContextItem</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="s2">&quot;generated-item-id&quot;</span><span class="p">,</span>
                <span class="n">thread_id</span><span class="o">=</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">created_at</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
                <span class="n">content</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;User sent message: </span><span class="si">{</span><span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s1">&#39;text&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="c1"># HiddenContextItems need to be manually saved because ChatKitServer</span>
            <span class="c1"># only auto-saves streamed items, and HiddenContextItem should never be streamed to the client.</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">add_thread_item</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">hidden</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>

            <span class="c1"># Stream an updated widget back to the client.</span>
            <span class="n">updated_widget</span> <span class="o">=</span> <span class="n">build_message_widget</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;text&quot;</span><span class="p">])</span>
            <span class="k">async</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">stream_widget</span><span class="p">(</span>
                <span class="n">thread</span><span class="p">,</span>
                <span class="n">updated_widget</span><span class="p">,</span>
                <span class="n">generate_id</span><span class="o">=</span><span class="k">lambda</span> <span class="n">item_type</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">store</span><span class="o">.</span><span class="n">generate_item_id</span><span class="p">(</span>
                    <span class="n">item_type</span><span class="p">,</span> <span class="n">thread</span><span class="p">,</span> <span class="n">context</span>
                <span class="p">),</span>
            <span class="p">):</span>
                <span class="k">yield</span> <span class="n">event</span>
</code></pre></div>
<p>Treat action payloads as untrusted input from the client.</p>
<h3 id="handle-actions-on-the-client">Handle actions on the client</h3>
<p>Provide <a href="https://openai.github.io/chatkit-js/api/openai/chatkit/type-aliases/widgetsoption"><code>widgets.onAction</code></a> when creating ChatKit on the client; you can still forward follow-up actions to the server from your <code>onAction</code> callback with the <code>sendCustomAction()</code> command if needed.</p>
<div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">chatkit</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">useChatKit</span><span class="p">({</span>
<span class="w">  </span><span class="c1">// ...</span>
<span class="w">  </span><span class="nx">widgets</span><span class="o">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">onAction</span><span class="o">:</span><span class="w"> </span><span class="kt">async</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">,</span><span class="w"> </span><span class="nx">widgetItem</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="kr">type</span><span class="w"> </span><span class="o">===</span><span class="w"> </span><span class="s2">&quot;save_profile&quot;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="kd">const</span><span class="w"> </span><span class="nx">result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">await</span><span class="w"> </span><span class="nx">saveProfile</span><span class="p">(</span><span class="nx">action</span><span class="p">.</span><span class="nx">payload</span><span class="p">);</span>

<span class="w">        </span><span class="c1">// Optionally invoke a server action after client-side work completes.</span>
<span class="w">        </span><span class="k">await</span><span class="w"> </span><span class="nx">chatkit</span><span class="p">.</span><span class="nx">sendCustomAction</span><span class="p">(</span>
<span class="w">          </span><span class="p">{</span>
<span class="w">            </span><span class="kr">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;save_profile_complete&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="p">{...</span><span class="nx">result</span><span class="p">,</span><span class="w"> </span><span class="nx">user_id</span><span class="o">:</span><span class="w"> </span><span class="kt">action.payload.user_id</span><span class="p">},</span>
<span class="w">          </span><span class="p">},</span>
<span class="w">          </span><span class="nx">widgetItem</span><span class="p">.</span><span class="nx">id</span><span class="p">,</span>
<span class="w">        </span><span class="p">);</span>
<span class="w">      </span><span class="p">}</span>
<span class="w">    </span><span class="p">},</span>
<span class="w">  </span><span class="p">},</span>
<span class="p">});</span>
</code></pre></div>
<p>On the server, handle the follow-up action (<code>save_profile_complete</code>) in the <code>action</code> method to stream refreshed widgets or messages.</p>
<h3 id="control-loading-behavior">Control loading behavior</h3>
<p>Use <code>loadingBehavior</code> to control how actions trigger different loading states in a widget.</p>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">Button</span>
<span class="w">  </span><span class="na">label</span><span class="o">=</span><span class="s">&quot;Send message&quot;</span>
<span class="w">  </span><span class="na">onClickAction</span><span class="o">=</span><span class="p">{{</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;send_message&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">loadingBehavior</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;container&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="p">}}</span>
<span class="p">/&gt;</span>
</code></pre></div>
<table>
<thead>
<tr>
<th>Value</th>
<th>Behavior</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>auto</code></td>
<td>The action will adapt to how itâ€™s being used. (<em>default</em>)</td>
</tr>
<tr>
<td><code>self</code></td>
<td>The action triggers loading state on the widget node that the action was bound to.</td>
</tr>
<tr>
<td><code>container</code></td>
<td>The action triggers loading state on the entire widget container. This causes the widget to fade out slightly and become inert.</td>
</tr>
<tr>
<td><code>none</code></td>
<td>No loading state</td>
</tr>
</tbody>
</table>
<p>Generally, we recommend using <code>auto</code>, which is the default. <code>auto</code> triggers loading states based on where the action is bound, for example:</p>
<ul>
<li><code>Button.onClickAction</code> â†’ <code>self</code></li>
<li><code>Select.onChangeAction</code> â†’ <code>none</code></li>
<li><code>Card.confirm.action</code> â†’ <code>container</code></li>
</ul>
<h2 id="create-custom-forms-with-widgets">Create custom forms with widgets</h2>
<p>Wrap widgets that collect user input in a <code>Form</code> to have their values automatically injected into every action triggered inside that form. The form values arrive in the action payload, keyed by each fieldâ€™s <code>name</code>.</p>
<ul>
<li><code>&lt;Select name="title" /&gt;</code> â†’ <code>action.payload["title"]</code></li>
<li><code>&lt;Select name="todo.title" /&gt;</code> â†’ <code>action.payload["todo"]["title"]</code></li>
</ul>
<div class="highlight"><pre><span></span><code><span class="p">&lt;</span><span class="nt">Form</span>
<span class="w">  </span><span class="na">direction</span><span class="o">=</span><span class="s">&quot;col&quot;</span>
<span class="w">  </span><span class="na">onSubmitAction</span><span class="o">=</span><span class="p">{{</span>
<span class="w">    </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;update_todo&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nx">payload</span><span class="o">:</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">id</span><span class="o">:</span><span class="w"> </span><span class="nx">todo</span><span class="p">.</span><span class="nx">id</span><span class="w"> </span><span class="p">},</span>
<span class="w">  </span><span class="p">}}</span>
<span class="p">&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Title</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;Edit Todo&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Text</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;Title&quot;</span><span class="w"> </span><span class="na">color</span><span class="o">=</span><span class="s">&quot;secondary&quot;</span><span class="w"> </span><span class="na">size</span><span class="o">=</span><span class="s">&quot;sm&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Text</span>
<span class="w">    </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">todo</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span>
<span class="w">    </span><span class="na">editable</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;title&quot;</span><span class="p">,</span><span class="w"> </span><span class="nx">required</span><span class="o">:</span><span class="w"> </span><span class="kc">true</span><span class="w"> </span><span class="p">}}</span>
<span class="w">  </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Text</span><span class="w"> </span><span class="na">value</span><span class="o">=</span><span class="s">&quot;Description&quot;</span><span class="w"> </span><span class="na">color</span><span class="o">=</span><span class="s">&quot;secondary&quot;</span><span class="w"> </span><span class="na">size</span><span class="o">=</span><span class="s">&quot;sm&quot;</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Text</span>
<span class="w">    </span><span class="na">value</span><span class="o">=</span><span class="p">{</span><span class="nx">todo</span><span class="p">.</span><span class="nx">description</span><span class="p">}</span>
<span class="w">    </span><span class="na">editable</span><span class="o">=</span><span class="p">{{</span><span class="w"> </span><span class="nx">name</span><span class="o">:</span><span class="w"> </span><span class="s2">&quot;description&quot;</span><span class="w"> </span><span class="p">}}</span>
<span class="w">  </span><span class="p">/&gt;</span>
<span class="w">  </span><span class="p">&lt;</span><span class="nt">Button</span><span class="w"> </span><span class="na">label</span><span class="o">=</span><span class="s">&quot;Save&quot;</span><span class="w"> </span><span class="na">submit</span><span class="w"> </span><span class="p">/&gt;</span>
<span class="p">&lt;/</span><span class="nt">Form</span><span class="p">&gt;</span>
</code></pre></div>
<p>On the server, read the form values from the action payload. Any action originating from inside the form will include the latest field values.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">AsyncIterator</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.server</span><span class="w"> </span><span class="kn">import</span> <span class="n">ChatKitServer</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">chatkit.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">Action</span><span class="p">,</span> <span class="n">ThreadMetadata</span><span class="p">,</span> <span class="n">ThreadStreamEvent</span><span class="p">,</span> <span class="n">WidgetItem</span>


<span class="k">class</span><span class="w"> </span><span class="nc">MyChatKitServer</span><span class="p">(</span><span class="n">ChatKitServer</span><span class="p">[</span><span class="n">RequestContext</span><span class="p">]):</span>
    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">action</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">thread</span><span class="p">:</span> <span class="n">ThreadMetadata</span><span class="p">,</span>
        <span class="n">action</span><span class="p">:</span> <span class="n">Action</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
        <span class="n">sender</span><span class="p">:</span> <span class="n">WidgetItem</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">context</span><span class="p">:</span> <span class="n">RequestContext</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AsyncIterator</span><span class="p">[</span><span class="n">ThreadStreamEvent</span><span class="p">]:</span>
        <span class="k">if</span> <span class="n">action</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s2">&quot;update_todo&quot;</span><span class="p">:</span>
            <span class="n">todo_id</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span>
            <span class="c1"># Any action that originates from within the Form will</span>
            <span class="c1"># include title and description</span>
            <span class="n">title</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;title&quot;</span><span class="p">]</span>
            <span class="n">description</span> <span class="o">=</span> <span class="n">action</span><span class="o">.</span><span class="n">payload</span><span class="p">[</span><span class="s2">&quot;description&quot;</span><span class="p">]</span>

            <span class="c1"># ...</span>
</code></pre></div>
<h3 id="validation">Validation</h3>
<p><code>Form</code> uses basic native form validation; it enforces <code>required</code> and <code>pattern</code> on configured fields and blocks submission when any field is invalid.</p>
<p>We may add new validation modes with better UX, more expressive validation, and custom error display. Until then, widgets are not a great medium for complex forms with tricky validation. If you need this, a better pattern is to use client-side action handling to trigger a modal, show a custom form there, then pass the result back into ChatKit with <code>sendCustomAction</code>.</p>
<h3 id="treating-card-as-a-form">Treating <code>Card</code> as a <code>Form</code></h3>
<p>You can pass <code>asForm=True</code> to <code>Card</code> and it will behave as a <code>Form</code>, running validation and passing collected fields to the Cardâ€™s <code>confirm</code> action.</p>
<h3 id="payload-key-collisions">Payload key collisions</h3>
<p>If there is a naming collision with some other existing pre-defined key on your payload, the form value will be ignored. This is probably a bug, so weâ€™ll emit an <code>error</code> event when we see this.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.copy", "content.code.select", "navigation.path", "navigation.sections", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>